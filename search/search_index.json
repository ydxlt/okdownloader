{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"OkDownloader","text":"<p>A downloader base on OkHttp for Java and Android.</p> <ul> <li>Easy to use: API like OkHttp</li> <li>Many features: support many scenes, such as synchronous/asynchronous download, you can use it easy in coroutines</li> <li>Modern: OkDownloader is Kotlin-first and base on OkHttp</li> <li>Easy to expand: support SPI and dynomic Interceptor to expand</li> </ul>"},{"location":"#features","title":"Features","text":"Feature Supported Synchronous download \u2705 Asynchronous download \u2705 Breakpoint download \u2705 Multi-threaded\u00a0download \u2705 Priority \u2705 Retry \u2705 Event subscribe \u2705 Subscrible API \u2705 Multi-downloader \u2705"},{"location":"#download","title":"Download","text":"<p>OkDownloader is available on <code>mavenCentral()</code>.</p> <pre><code>implementation(\"com.billbook.lib:downloader:1.0.0\")\n</code></pre>"},{"location":"#quick-start","title":"Quick Start","text":"<p>Build a downloader just like build OkHttpClient</p> <pre><code>val downloader = Downloader.Builder().build()\n</code></pre> <p>Start download</p> <pre><code>val request = Download.Request.Builder()\n.url(url)\n.into(path) // or into(file)\n.build()\nval call = downloader.newCall(request)\nval response = call.execute() // synchronous download\n// use response here\n</code></pre> <p>or</p> <pre><code>call.enqueue() // Asynchronous download\n</code></pre> <p>with callback</p> <pre><code>call.enqueue(object : Download.Callback {\n// ...\noverride fun onSuccess(call: Download.Call, response: Download.Response) {\n// do your job\n}\noverride fun onFailure(call: Download.Call, response: Download.Response) {\n// do your job\n}\n})\n</code></pre> <p>Cancel download</p> <pre><code>call.cancel() // or call.cancelSafely()\n</code></pre>"},{"location":"#how-to-expand","title":"How to expand","text":"<p>Dynamically add interceptors</p> <pre><code>val downloader = Downloader.Builder()\n.addInterceptor(CustomInterceptor())\n.build()\n</code></pre> <p>or</p> <p>Declare your interceptors using SPI,In META-INF/services/com.billbook.lib.Interceptor</p> <pre><code>com.example.CustomInterceptor1\ncom.example.CustomInterceptor2\ncom.example.CustomInterceptor3\n</code></pre>"},{"location":"#r8proguard","title":"R8/Proguard","text":"<p>OkDownloader is fully compatible with R8 out of the box and doesn't require adding any extra rules. If you use Proguard, you may need to add rules for OkHttp and Okio.</p>"},{"location":"#license","title":"License","text":"<pre><code>Copyright 2023 Billbook, Inc.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\nhttp://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n</code></pre>"},{"location":"getting_started/","title":"Getting Started","text":""},{"location":"getting_started/#_1","title":"\u5f02\u6b65\u4e0b\u8f7d","text":"<p><code>\u540c\u6b65\u4e0b\u8f7d</code>\u610f\u5473\u7740\u5728\u5f02\u6b65\u7ebf\u7a0b\u4e2d\u6267\u884c</p> <pre><code>val request = Download.Request.Builder()\n.url(url)\n.into(file)\n.build()\nval call = downloader.newCall(request)\ncall.enqueue()\n</code></pre> <p>\u6dfb\u52a0\u56de\u8c03\u76d1\u542c</p> <pre><code>call.enqueue(object : Download.Callback {\n// ...\noverride fun onSuccess(call: Download.Call, response: Download.Response) {\n// do your job\n}\noverride fun onFailure(call: Download.Call, response: Download.Response) {\n// do your job\n}\n})\n</code></pre>"},{"location":"getting_started/#_2","title":"\u540c\u6b65\u4e0b\u8f7d","text":"<p><code>\u540c\u6b65\u4e0b\u8f7d</code>\u610f\u5473\u7740\u5728\u5f53\u524d\u7ebf\u7a0b\u4e2d\u6267\u884c\uff0c\u5373\u963b\u585e\u8c03\u7528\u7ebf\u7a0b\u6267\u884c</p> <pre><code>val request = Download.Request.Builder()\n.url(url)\n.into(file)\n.build()\nval call = downloader.newCall(request)\nval response = call.execute()\n</code></pre> <p>\u6dfb\u52a0\u56de\u8c03\u76d1\u542c</p> <pre><code>call.execute(object : Download.Callback {\n// ...\noverride fun onSuccess(call: Download.Call, response: Download.Response) {\n// do your job\n}\noverride fun onFailure(call: Download.Call, response: Download.Response) {\n// do your job\n}\n})\n</code></pre> <p>\u901a\u5e38\uff0c\u5728\u534f\u7a0b\u4e2d\u4f7f\u7528\u540c\u6b65\u4e0b\u8f7d</p> <pre><code>withContext(Dispatchers.IO){\nval request = Download.Request.Builder()\n.url(url)\n.into(file)\n.build()\nval call = downloader.newCall(request)\nval response = call.execute()\n}\n</code></pre>"},{"location":"getting_started/#_3","title":"\u8d44\u6e90\u6821\u9a8c","text":"<p>\u53ef\u4ee5\u7ed9 Request \u8bbe\u7f6e md5\uff0c\u8fd9\u6837\u4f1a\u8fdb\u884cMD5 \u6821\u9a8c</p> <p><pre><code>val request = Download.Request.Builder()\n// ..\n.md5(md5)\n.build()\n</code></pre> \u8fd8\u53ef\u4ee5\u8bbe\u7f6e\u6587\u4ef6\u5927\u5c0f\uff0c\u8fd9\u6837\u5728\u4e0b\u8f7d\u5b8c\u6210\u65f6\u4f1a\u6821\u9a8c\u6587\u4ef6\u5927\u5c0f</p> <pre><code>val request = Download.Request.Builder()\n// ..\n.size(size)\n.build()\n</code></pre>"},{"location":"getting_started/#_4","title":"\u8bbe\u7f6e\u91cd\u8bd5","text":"<p>\u8bbe\u7f6e\u91cd\u8bd5\u6b21\u6570\uff0c\u9ed8\u8ba4\u91cd\u8bd5\u6b21\u6570\u4e3a 3 \u6b21</p> <pre><code>val request = Download.Request.Builder()\n// ..\n.retry(5)\n.build()\n</code></pre>"},{"location":"getting_started/#_5","title":"\u8bbe\u7f6e\u4f18\u5148\u7ea7","text":"<p>OkDownloader\u652f\u6301 High\uff0cMIddle\uff0clow \u4e09\u79cd\u4f18\u5148\u7ea7\uff0c\u9ed8\u8ba4\u4f18\u5148\u7ea7\u4e3a Middle</p> <pre><code>val request = Download.Request.Builder()\n// ..\n.priority(Download.Priority.HIGH)\n.build()\n</code></pre>"},{"location":"getting_started/#tag","title":"\u8bbe\u7f6etag","text":"<p>\u7528\u6765\u6807\u8bb0\u4efb\u52a1\uff0c\u53ef\u7528\u4e8e\u4e0a\u62a5\u533a\u5206 App \u4e2d\u7684\u4e0d\u540c\u4e1a\u52a1</p> <pre><code>val request = Download.Request.Builder()\n// ..\n.tag(tag)\n.build()\n</code></pre>"},{"location":"getting_started/#_6","title":"\u4efb\u52a1\u8ba2\u9605","text":"<p>OkDownloader\u9664\u4e86\u4efb\u52a1\u56de\u8c03\u4e4b\u5916\uff0c\u8fd8\u652f\u6301\u4efb\u52a1\u8ba2\u9605\uff0c\u5982\u4e0b\u5c06\u4f1a\u8ba2\u9605\u8be5 Downloader\u6240\u6709\u7684\u4e0b\u8f7d\u4efb\u52a1\u7ed3\u679c</p> <pre><code>val subscriber = object : Download.Subscriber {\noverride fun onSuccess(call: Download.Call, response: Download.Response) {\n// Do you job\n}\noverride fun onFailure(call: Download.Call, response: Download.Response) {\n// Do you job\n}\n}\ndownloader.subscribe(subscriber)\n</code></pre> <p>\u53d6\u6d88\u8ba2\u9605</p> <pre><code>downloader.unsubscribe(subscriber)\n</code></pre>"},{"location":"optional_settings/","title":"\u81ea\u5b9a\u4e49\u4e0b\u8f7d\u8bbe\u7f6e","text":"<p>\u4ee5\u4e0b\u8bbe\u7f6e\u9879\u5747\u53ef\u9009\uff0c\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9879\u76ee\u9700\u8981\u8fdb\u884c\u8bbe\u7f6e</p>"},{"location":"optional_settings/#_2","title":"\u4e8b\u4ef6\u76d1\u542c","text":"<p>\u901a\u8fc7<code>eventListenerFactory</code>\u65b9\u6cd5\u8bbe\u7f6e\u4e0b\u8f7d\u4e8b\u4ef6\u76d1\u542c\uff0c\u5982\u4e0b\u662f\u8bbe\u7f6e\u4e0a\u62a5\u7684\u4e00\u4e2a\u793a\u4f8b</p> <pre><code>val downloader = Downloader.Builder()\n.eventListenerFactory { ReporterEventListener() }\n.build()\n</code></pre> <p>ReporterEventListener</p> <pre><code>class ReporterEventListener : EventListener() {\noverride fun callSuccess(call: Download.Call, response: Download.Response) {\n// do your job\n}\noverride fun callFailed(call: Download.Call, response: Download.Response) {\n// do your job\n}\n}\n</code></pre>"},{"location":"optional_settings/#_3","title":"\u76d1\u542c\u4efb\u52a1\u7a7a\u95f2","text":"<p>\u901a\u8fc7<code>idleCallback</code>\u8bbe\u7f6e\u4efb\u52a1\u7a7a\u95f2\u76d1\u542c</p> <pre><code>val downloader = Downloader.Builder()\n.idleCallback { // download pool idle }\n.build()\n</code></pre>"},{"location":"optional_settings/#okhttpclient","title":"\u81ea\u5b9a\u4e49 OkHttpClient","text":"<p>\u901a\u8fc7<code>okhttpClientFactory</code>\u8bbe\u7f6e\u81ea\u5b9a\u4e49 OkHttpClient</p> <pre><code>val downloader = Downloader.Builder()\n.okHttpClientFactory { buildOkHttpClient() }\n.build()\nprivate fun buildOKHttpClient(): OkHttpClient {\nreturn OkHttpClient.Builder()\n.connectTimeout(15, TimeUnit.SECONDS)\n.readTimeout(15, TimeUnit.SECONDS)\n.writeTimeout(15, TimeUnit.SECONDS)\n.retryOnConnectionFailure(true)\n.cache(null)\n.build()\n}\n</code></pre>"},{"location":"optional_settings/#_4","title":"\u8bbe\u7f6e\u9ed8\u8ba4\u91cd\u8bd5\u6b21\u6570","text":"<p>\u9ed8\u8ba4\u91cd\u8bd5\u6b21\u6570\u4e3a 3 \u6b21</p> <pre><code>val downloader = Downloader.Builder()\n.defaultMaxRetry(10)\n.build()\n</code></pre>"},{"location":"optional_settings/#_5","title":"\u8bbe\u7f6e\u4efb\u52a1\u6267\u884c\u7ebf\u7a0b\u6c60","text":"<p>\u8c03\u7528<code>executorService</code>\u8bbe\u7f6e\u5f02\u6b65\u4e0b\u8f7d\u4efb\u52a1\u6267\u884c\u7ebf\u7a0b\u6c60</p> <pre><code>val downloader = Downloader.Builder()\n.executorService(CustomExecutorService())\n.build()\n</code></pre>"}]}